{% extends 'dashboard/base.html' %}
{% load static i18n %}
{% block title %}{{book.title}}{% endblock %}
{% block content %}

<div class="container px-2 book-detail d-flex flex-column align-items-center">
  <div class="hero-container bg-darkest-color mt-0 d-flex flex-column justify-content-center">
    <div class="title text-center joy-color p-2">{{book.title}}</div>
  </div>
  <!-- Cover + basic infos -->
  <div class="book-infos d-flex">
    <div class="pe-1">
      {% if book.picture %}
      <img class="mx-auto" src="{{book.picture.url}}" alt="{{book.title}}" />
      {% elif book.cover %}
      <img class="mx-auto" src="{{book.cover}}" alt="{{book.title}}" />
      {% else %}
      <img class="mx-auto" src="{% static 'assets/img/illustrations/book-default.png'%}" alt="{{book.title}}" />
      {% endif %}
    </div>

    <div class="ps-1 text-center">
      <p class="lightest-color">{% trans 'By' %} {{book.author}}</p>
      <p class=" mt-4 book-data-dat mb-0 text-center">{{book.pages }} {% trans 'pages' %}</p>
      {% if book.book.averagereview %}
      
      <p class="mt-2 mb-0">{% trans 'Average rating' %}</p>
      {{book.book.averagereview}}
      {% endif %}
      <!-- Reading status -->
      <div class="mt-3">
      <a href="{% url "edit-reading-status" book.book.slug book.id %}" class="mt-4 reading-status mx-auto
        {% if is_read %}
          darkest-color bg-joy-color">{% trans "Read" %}
        {% elif is_reading %}
          light-color bg-brand-color">{% trans "Reading Now" %}
        {% elif in_wish %}
          darkest-color bg-dark-color">{% trans "Want to read" %}
        {% elif no_read %}
          light-color bg-darkest-color">{% trans "Not read" %}
        {% elif wont_read %}
          darkest-color bg-mid-color">{% trans "Dont'want to read" %}
        {% elif give_up %}
          darkest-color bg-light-color">{% trans "Given up" %}
        {% else %}
          darkest-color bg-light-color">{% trans "Add Reading Status" %}
        {% endif %}

      </a>
      </div>
    </div>
  </div>
  <!-- Cover + basic infos End-->

  <!-- Book groups -->
  <div class="d-flex flex-column">
    <!-- Actual groups -->
    <div class="d-flex mt-3">
      {% for group in groups_of_book %}
        <div class="d-flex flex-column align-items-center mx-2
          {% if group.group_type == 'library' %}
          order-1">
          <div class="group-icon-small bg-brand-color d-flex justify-content-center align-items-center">
            <i class="fa fa-lines-leaning lightest-color m-0"></i>
          </div>
          {% elif group.group_type == 'wishlist' %}
            order-1" >
            <div class="group-icon-small bg-mid-color d-flex justify-content-center align-items-center">
              <i class="fa-solid fa-bookmark lightest-color m-0"></i>
            </div>
          {% else %}
            order-2">
              {% if group.group_pic%}
                  <img class="group-img-small" src="{{group.group_pic.url}}" />
              {% else %}
                  <img class="group-img-small" src="{% static 'assets/img/illustrations/group_default.jpeg' %}" />
              {% endif %}
          {% endif %}
          <p class="small">{{group.kname}}</p>
        </div>
      {% endfor %}
    </div>
      {% if sharing_groups %}
        {% for group in sharing_groups %}
           {% if group in available_sharing_groups %}
           <div class="d-flex flex-column align-items-center mx-2 order-3">
              <a class="darkest-color text-center" href="{% url 'pass-book-to-sharing-club' book.slug %}">
              <p class="small my-0">{% trans 'Share within' %}</p>
                {% if group.group_pic%}
                    <img class="group-img-small" src="{{group.group_pic.url}}" />
                {% else %}
                    <img class="group-img-small" src="{% static 'assets/img/illustrations/group_default.jpeg' %}" />
                {% endif %}
                <p class="small">{{group.kname}}</p>
              </a>
            </div>
            {% endif %}
        {% endfor %}
      {% endif %}
</div>

  
    
  <!-- Book Borrow -->
  <div style="width:200px;" class="mx-auto">
  {% if is_borrowable %}
    {% for kbook in borrowable_kbooks %}
    <a class="btn btn-darkest-color" href="{% url 'borrow-within-group' kbook.id kbook.group.slug %}">
      {% trans 'Borrow from' %}  {{kbook.owner}} 
    </a>
    {% endfor %}
  {% endif %}

  {% if borrows %}
    {% for borrow in borrows %}
      {% if borrow.borrower == request.user %}
        <a class="btn btn-darkest-color text-white" href="#">
      
      {% trans 'Borrowed by me. Mark as given back ?' %}
      {% else %}
      <a class="btn btn-darkest-color text-white" href="#">
      
      {% trans 'Borrowed by' %} {{borrow.borrower}} 
      {% trans 'Mark as given back' %} ?

      {% endif %}
     
    </a>
    {% endfor %}
  {% endif %}
   </div>
 


  <!-- Book Borrow End -->
  <!-- Book description -->
  <div class="mt-5 book-description">
    {% if book.description %}
    {{book.description}}
    {% endif %}
  </div>
  <!-- Book description End-->


  <!-- Reviews -->
  <div class="mt-5 d-flex flex-wrap justify-content-center">
  {% for review in group_reviews%}
    <div class="blockquote">
      <p>
      {{review.message}}
      </p>
      <h4><strong>&mdash;{{review.author.pseudo}}</strong><br><span class="dark-color">{{review.rating}}/5</span></h4>
      {% if review.author == request.user %}
      <div class="d-flex justify-content-end">
      <a class="darkest-color" href={% url 'edit-review' review.id %}><i class="fa fa-pen"></i></a>
      </div>
      {% endif %}
      <img class="curly1" src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/95802/Curly_Krungthep.svg' alt=''>
      <img class="curly2" src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/95802/Curly_Krungthep.svg' alt=''>
    </div>

  {% endfor %}
  </div> <!-- End Reviews -->


</div>

<!-- Button -->

<div class="btn-container">
    <div class="expandable-button">
      <div class="fill-block"></div>
      <div class="close-icon">
        <div class="fas fa-times"></div>
      </div><a class="expansion-item" href="{% url 'add-review' book.slug %}">
        <div class="expansion-content">
          <div class="icon fas fa-star"></div>
          <div class="text">{% trans 'Review' %}</div>
        </div></a><a class="expansion-item" href="{% url 'edit-book' book.slug%}">
        <div class="expansion-content">
          <div class="icon fas fa-pen"></div>
          <div class="text">Edit</div>
        </div></a><a class="expansion-item" href="{% url 'delete-book-from-group' book.book.slug%}">
        <div class="expansion-content">
          <div class="icon fas fa-trash"></div>
          <div class="text">{% trans 'Delete' %}</div>
        </div></a>
    </div>
</div>



{% endblock %}

{% block extrajs %}

<script>
const select = (s) => document.querySelector(s);

const btn = select(".expandable-button");

btn.addEventListener("click", () => {
  btn.classList.toggle("expanded");
});


</script>

{% endblock %}